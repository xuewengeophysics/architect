# 知识图谱

## 1 前言

### 1.1 课程设计

+ 知识图谱概要
  + 知识图谱的基本概念
  + 知识的表示
  + 存储系统
  + 构建知识图谱需要用到的AI技术

+ 经典案例剖析
  + 从零开始搭建知识图谱系统
  + 老师自己的思考

+ 知识推理技术

+ 在工程落地上遇到的问题和解决思路

### 1.2 课程目标

+ 入门级、self-contained、小型
+ 教你如何快速搭建垂直领域的知识图谱
+ 对知识图谱在不同行业中的应用有清晰的了解
+ 学习跟知识图谱相关的AI技术

### 1.3 课程大纲

+ 知识图谱基础
+ 从零搭建金融知识图谱
+ 其它垂直领域中的应用
+ **知识推理(难)**、常见问题

## 2 知识图谱基础

+ 语义网络
+ 多关系图：由多种类型的节点和多种类型的边组成

+ 知识图谱的表示：用实体和关系的表示；还可以给实体和关系添加属性(例如：把年龄和职位作为属性添加给某个人；也可以把时间作为属性添加到Has_phone这个关系里面来表达开通电话号码的时间)，即属性图；RDF不支持存储属性，有属性的知识图谱用图数据库来存储

+ 知识图谱和搜索：通过关键词直接给出答案，而不是倒排序的多个搜索结果
+ 知识图谱的存储：
  + RDF存储系统：以三元组的形式存储。Neo4j
  + 图数据库：以属性图的形式存储。Jena
  + 两者不同点：
    + 对属性的处理：
    + 对同一种类型的关系的处理：
    + 设计目的不同：RDF主要来自于学术界，易于数据的发布、分享；图数据库来自于工业界需求，拥有一般数据库拥有的特性，比如事务管理(Transaction Management)，用于做高效的图查询。
+ 知识图谱的构建：
  + 关键原则：
    + 定义正确的问题
    + 从业务痛点出发
    + 多问为什么要用知识图谱来解决，传统数据库系统难道不能解决吗？
    + 目前的知识图谱并不具备强大的推理能力；当前主流还是基于规则
  + 技术：
    + 命名实体识别
    + 关系抽取
    + 实体统一：例如NYC与纽约
    + 指代消解：It指代什么？



## 3 构建风控知识图谱

### 3.1 知识图谱构建介绍

+ 构建方法：
  + 基于规则的方法论
  + 基于概率的方法论
  + 语义网络(很难落地)
+ 构建步骤：
  + 问题定义
  + 数据收集
  + 数据预处理
  + 设计知识图谱
  + 存储知识图谱
  + 应用知识图谱
  + 评估系统

### 3.2 问题定义

### 3.3 什么时候需要知识图谱

+ 有没有强烈的可视化需求？
+ 有没有涉及深度搜索的场景？
+ 对查询效率有无实时性要求？
+ 数据多样化、解决数据孤岛问题？
+ 是否有能力和成本搭建知识图谱系统？
+ 是否有一定的知识推理的需求？

### 3.4 数据的收集

+ 需要哪些数据
  1. 已经有哪些数据？
  2. 有可能拿到哪些数据？
  3. 哪些数据可以用来降低欺诈风险？
  4. 哪些数据可以用来构建知识图谱？
+ 潜在数据源
  1. 用户基本数据：姓名、年龄、公司
  2. 用户行为数据：页面停留时长、输入时间
  3. 运营商数据：主叫或被叫、通话时长
  4. 电商数据：购买物品、物品介绍
  5. 黑名单：已被评定为欺诈的人群
  6. 公开数据：贴吧、论坛等数据
+ 对标：
  1. M端基本数据：公司名称、成立时间、营业额
  2. M端生产数据：产能、交期、质量、价格

### 3.5 数据的预处理

1. 用户基本数据：数据清洗
2. 用户行为数据：统计操作
3. 运营商数据：统计操作
4. 电商数据：文本分析
5. 黑名单：提取列表
6. 公开数据：信息抽取



+ 通过数据预处理之后，所有数据转换成结构化数据。接下来要做：
  1. 哪些数据用来构建知识图谱，哪些数据保存在传统的数据库？
  2. 对于进入知识图谱的数据，怎么设计实体、关系、属性？

### 3.6 知识图谱的设计

#### 3.6.1 需要考虑的问题

+ 需要哪些实体、关系、属性？
+ 哪些属性可以作为实体？哪些实体可以作为属性？
+ 那些信息不需要放在知识图谱？

3.6.2 BAER原则

+ 业务原则(Business Principle)：一切要从业务逻辑出发，也就是说通过观察知识图谱的设计也很容易推测其背后业务的逻辑。而且设计时也要想好未来业务的变化。
  + 要注意：实体的重要性要大于属性
+ 分析原则(Analytics Principle)：知识图谱中任何一个实体都是为关系分析而服务的，如果一个实体对分析网络结构没有帮助，则可以设置成属性甚至不要放在知识图谱里。
+ 冗余原则(Redundancy Principle)：知识图谱设计中，避免把**超级节点**放入到知识图谱中，这会导致系统的性能急剧降低。并且，避免存放任何重复信息。
+ 效率原则(Efficiency Principle)：知识图谱要尽量轻便，只存储关键信息，剩下的可以存储在传统的数据库中。
  + 什么是有必要的信息呢？
    + 第1个特性：这种信息会经常被访问到；
    + 第2个特性：这种信息对于构建网络以及分析网络本身来说价值比较大；

### 3.7 存储知识图谱

**RDF还是属性图？**

对风控知识图谱来说：

1. 部分实体拥有属性
2. 对于关系深度搜索要求高

+ 属性图的存储
  1. Neo4j：与其它的存储系统相比，Neo4j更成熟，坑也少。如果数据量不是特别大(比如不超过50亿节点)。不支持准分布式。
  2. OrientDB：支持准分布式。
  3. JanusGraph：支持准分布式。

### 3.8 应用知识图谱

知识图谱应用在反欺诈

1. 基于规则的方法：根据历史经验设定好规则，并在知识图谱中进行搜索以及验证。

   + 两种不同类型的规则
     + 不需要知识图谱：如果申请人年龄少于20，则拒贷
     + 知识图谱场景：如果申请人朋友中有10%以上的人有过逾期，则拒贷
   + 单个规则的判断
     + 知识图谱起到的最大的作用是其搜索能力。比如在历史数据中，验证上面这条规则；再进一步，想为这条规则选择最好的阈值(X%)。传统数据库可能需要几个小时甚至几天，而知识图谱在几毫秒到几秒就能完成
     + 信息矛盾：不一致性验证1，例如
     + 信息提取：
       + 例如借款人二度关系里有多少个实体在黑名单里？在知识图谱里面很容易直观统计出来。
       + 例如跟借款人联系过的二度人脉里，有多少人曾经逾期过？
     + 基于知识图谱的特征最好也需要跟深度搜索有关。不然也不需要知识图谱的支持。
   + 模式判断：组团欺诈 
     1. 多点共享信息
     2. 三角关系
     3. 强连通图
     4. 团：图中任意两个节点都有联系
     5. 弱连通图

   

2. 基于概率的方法

   + 社区发现：给定一个庞大的关系网络G，以及给定社区数据K，通过社区挖掘算法(选择一个合适的算法)把网络G分成K个社区，再通过图中已有的标签来分析哪些社区存在欺诈风险。
   + 概率模型
     + 标签传播(LPA)：核心思想是通过网络中节点之间的相互影响来判断每个节点最终的状况，比如一个好的学生有可能被不务正业的人带坏。类似的，如果一个借款人的一度、二度、三度人脉里有一些逾期过的人，那我们也可以认为将来这个借款人也有一些逾期的概率。至于概率的大小，需要通过标签传播算法来计算。
     + LOUVAIN
     + 聚类
   + 动态知识图谱的存储
     + 把每个时间点的关系图都存下来：低效、占空间大；
     + 把T=0时间的图存下来，之后只存储跟前面时间点不一样的模块(difference)。
   + 对于特别大的，可以进行离线分析。



## 4 其它领域领域中的应用

### 4.1 证券投资

### 4.2 聊天机器人



### 4.3 智慧教育

### 4.4 推荐系统



## 5 关键推理技术

5.1 基于规则的推理

5.2 分布式表示法

5.3 基于深度学习的推理

## 6 工程中的Q&A

### 6.1 存储系统的选择

+ RDF
+ 属性图
  + 不支持分布式：Neo4j
  + 支持分布式：JanusGraph、OrientDB

### 6.2 超级节点的处理

+ 超级节点：当一个实体(节点)跟其它非常多的实体相连时，我们称其为超级节点。超级节点对性能的影响非常大，所以要妥善处理这类节点。例如：10086。
+ 对于超级节点的处理：从设计的角度，尽量避免创建超级节点。从知识图谱设计中的冗余原则来看，加入超级节点并不会带来额外的价值。

### 6.3 大规模数据的分析

+ Neo4j主要用于数据的查询，它的核心在于高效地做深度关系类搜索，不适合作为大规模数据的分析。
+ 如果需要对知识图谱的数据做大规模的分析，比如对上亿个节点跑社区挖掘、标签传播等算法，我们则需要借助分析平台，例如GraphX、GraphLab等

### 6.4 设置为实体还是属性

+ 业务原则：重要的信息设置为实体，次要的信息设置为属性。例如风控知识图谱中的人。
+ 分析原则：如果信息对于分析网络结构有帮助，则可以设置为实体。例如风控知识图谱中的电话号码。